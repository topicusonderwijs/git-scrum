#!/bin/bash

set -e

remote=$(git config "branch.master.remote")
if [ "--local" == "$1" ]; then
	tasks=`git branch --list task\* | cut -f2- -d-`
else
	tasks=`git branch -r --list $remote/task\* | cut -f2- -d/ | cut -f2- -d-`
fi

for task in $tasks; do
	if [ "--simple" == "$2" ]; then
		echo $task
	else
		stat=`git task-status $task`
		aheadmaster=`git rev-list "$remote/master..$remote/task-$task" --no-merges | wc -l`
		echo "$task  [$stat] ($aheadmaster commits ahead of master)"
	fi
done
