#!/bin/bash

set -e
source "${0%[\\/]*}"/_git-common.sh

if [ "$#" -ne 1 ]; then
    echo "Usage: git task-start [source-branch] [task-]name"
    exit 1
fi

if [ "$#" -eq 1 ]; then
	task=$1
	branchMenu
else
	task=$2   
	srcBranch=$1 
fi

git checkout $srcBranch

git task-sync $srcBranch || ( echo "git-task-sync failed"; exit 1 )

if [[ $task == task-* ]]; then
	task=${task:5}
fi

echo Starting "'"task-$task"'"

remote=$(git config "branch.$srcBranch.remote"||true)
if [ "$remote" == "" ]; then
	remote="origin"
fi

git checkout -b task-$task $srcBranch
git push -u $remote task-$task
git config --unset branch.task-$task.rebase || true


